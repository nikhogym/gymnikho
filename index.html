<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Treino Nikho Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #0A84FF; --success: #30D158; --danger: #FF453A; --bg: #000000; --card: #1C1C1E; --text: #FFFFFF; --input-bg: #2C2C2E; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; padding-top: 80px; }
        
        .tabs { 
            display: flex; gap: 8px; position: fixed; top: 0; left: 0; right: 0; 
            background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 15px 10px; z-index: 1000; border-bottom: 1px solid #3A3A3C;
        }
        .tab-btn { flex: 1; padding: 10px 5px; border: none; border-radius: 12px; background: var(--input-bg); color: #8E8E93; font-weight: bold; font-size: 12px; }
        .tab-btn.active { background: var(--primary); color: white; }

        .container { width: 100%; max-width: 450px; margin: auto; }
        .content { display: none; width: 100%; }
        .content.active { display: block; }

        .card { background: var(--card); padding: 20px; border-radius: 22px; margin-bottom: 15px; border: 1px solid #2C2C2E; }
        .section-title { font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; color: var(--primary); font-weight: bold; }
        
        .input-row { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; }
        
        input, select, textarea { background: var(--input-bg); border: 1px solid #3A3A3C; border-radius: 12px; color: white; padding: 12px; font-size: 14px; outline: none; width: 100%; }
        input:focus { border-color: var(--primary); }

        .btn { width: 100%; padding: 16px; border: none; border-radius: 16px; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.1s; }
        .btn:active { opacity: 0.6; transform: scale(0.98); }
        .btn-add { background: var(--primary); color: white; }
        .btn-finish { background: var(--success); color: white; margin-top: 15px; }
        .btn-dropdown { background: #3A3A3C; color: white; padding: 12px; border-radius: 12px; width: 50px; flex-shrink: 0; font-size: 18px; display: flex; align-items: center; justify-content: center; }

        ul { list-style: none; padding: 0; margin-top: 15px; }
        li { background: var(--input-bg); padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid var(--primary); }
        
        .last-weight-info { font-size: 11px; color: var(--success); margin-bottom: 8px; display: block; font-weight: bold; }
        #historico { margin-top: 20px; }
        .historico-item { background: var(--card); padding: 15px; border-radius: 18px; margin-bottom: 10px; border: 1px solid #3A3A3C; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button id="btn-treino" class="tab-btn active" onclick="switchTab('treino')">üí™ Treinar</button>
        <button id="btn-fichas" class="tab-btn" onclick="switchTab('fichas')">üìã Fichas</button>
        <button id="btn-grafico" class="tab-btn" onclick="switchTab('grafico')">üìà Evolu√ß√£o</button>
    </div>

    <div id="treino" class="content active">
        <div class="card">
            <div class="section-title">üèãÔ∏è Muscula√ß√£o</div>
            
            <div id="referenciaPeso"></div>
            
            <div class="input-row">
                <input type="text" id="ex" placeholder="Nome do exerc√≠cio" list="listaAprendida" oninput="buscarUltimoPeso(this.value)">
                <button class="btn-dropdown" onclick="document.getElementById('ex').focus();">‚ñæ</button>
            </div>

            <datalist id="listaAprendida"></datalist>

            <div class="input-grid">
                <input type="number" id="sets" placeholder="S√©r.">
                <input type="number" id="reps" placeholder="Rep.">
                <input type="number" id="peso" placeholder="Kg">
            </div>
            
            <button class="btn btn-add" onclick="adicionar()">Adicionar √† Lista</button>
            
            <div style="margin-top:15px; background:#2C2C2E; padding:12px; border-radius:12px;">
                <span style="font-size:12px; color:#8E8E93">üî• Calorias Muscula√ß√£o</span>
                <input type="number" id="calMusculo" placeholder="0 kcal" style="margin-top:5px">
            </div>
            
            <ul id="listaAtual"></ul>
        </div>

        <div class="card">
            <div class="section-title">üèÉ Cardio</div>
            <div class="input-row">
                <select id="cardioTipo" style="flex: 2;">
                    <option value="Esteira">Esteira</option>
                    <option value="Bicicleta">Bicicleta</option>
                    <option value="Corda">Corda</option>
                </select>
                <input type="number" id="cardioTempo" placeholder="Min" style="flex: 1;">
            </div>
            <div style="background:#2C2C2E; padding:12px; border-radius:12px;">
                <span style="font-size:12px; color:#8E8E93">üî• Calorias Cardio</span>
                <input type="number" id="calCardio" placeholder="0 kcal" style="margin-top:5px">
            </div>
            <button class="btn btn-finish" onclick="finalizar()">Finalizar e Sincronizar</button>
        </div>

        <div id="historico"></div>
    </div>
</div>

<script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyjhUFfkvnlz-AnpSmgA6ZXeASbeBm_7nHl6cFDuKTuIWVx_Iv1Aq8pb_M8RcxMa0ly/exec";

    let atual = JSON.parse(localStorage.getItem('treino_v13')) || [];
    let hist = JSON.parse(localStorage.getItem('hist_v13')) || [];

    // Fun√ß√£o que faz o App "Aprender" com o seu hist√≥rico
    function atualizarSugestoes() {
        const datalist = document.getElementById('listaAprendida');
        const exerciciosUnicos = new Set();
        
        // Percorre o hist√≥rico e adiciona nomes √† lista sem repetir
        hist.forEach(treino => {
            treino.itens.forEach(item => exerciciosUnicos.add(item.ex));
        });

        datalist.innerHTML = Array.from(exerciciosUnicos)
            .sort()
            .map(nome => `<option value="${nome}">`)
            .join('');
    }

    function buscarUltimoPeso(nomeEx) {
        if (!nomeEx || nomeEx.length < 3) { document.getElementById('referenciaPeso').innerHTML = ""; return; }
        const treinoAnterior = hist.find(t => t.itens.some(i => i.ex.toLowerCase() === nomeEx.toLowerCase()));
        if (treinoAnterior) {
            const item = treinoAnterior.itens.find(i => i.ex.toLowerCase() === nomeEx.toLowerCase());
            document.getElementById('referenciaPeso').innerHTML = `<span class="last-weight-info">üí° √öltima vez: ${item.p}kg (${item.s}x${item.r})</span>`;
        }
    }

    function adicionar() {
        const ex = document.getElementById('ex').value;
        const s = document.getElementById('sets').value, r = document.getElementById('reps').value, p = document.getElementById('peso').value;
        if (ex && s && r) {
            atual.push({ ex, s, r, p });
            localStorage.setItem('treino_v13', JSON.stringify(atual));
            render();
            ["ex","sets","reps","peso"].forEach(id => document.getElementById(id).value = '');
        }
    }

    function render() {
        document.getElementById('listaAtual').innerHTML = atual.map((i, idx) => `
            <li>
                <div style="display:flex; justify-content:space-between">
                    <strong>${i.ex}</strong>
                    <span onclick="remover(${idx})" style="color:var(--danger)">‚úï</span>
                </div>
                <div style="font-size:12px; color:#8E8E93; margin-top:4px">${i.s}x${i.r} - ${i.p}kg</div>
            </li>`).join('');
    }

    function remover(idx) {
        atual.splice(idx, 1);
        localStorage.setItem('treino_v13', JSON.stringify(atual));
        render();
    }

    async function finalizar() {
        const cM = parseFloat(document.getElementById('calMusculo').value) || 0;
        const cC = parseFloat(document.getElementById('calCardio').value) || 0;
        if (atual.length === 0 && (cM + cC) === 0) return;

        const novo = { id: Date.now(), data: new Date().toLocaleDateString('pt-BR'), calTotal: cM + cC, calM: cM, calC: cC, itens: [...atual] };
        hist.unshift(novo);
        localStorage.setItem('hist_v13', JSON.stringify(hist));

        try {
            await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(novo) });
            alert("Sucesso! Sincronizado com a nuvem.");
        } catch (e) {
            alert("Salvo localmente.");
        }

        atual = [];
        localStorage.setItem('treino_v13', "[]");
        renderHist();
        atualizarSugestoes(); // Atualiza a lista com o que acabou de aprender
        render();
        ["calMusculo", "calCardio", "cardioTempo"].forEach(id => document.getElementById(id).value = '');
    }

    function renderHist() {
        document.getElementById('historico').innerHTML = hist.slice(0, 5).map(h => `
            <div class="historico-item">
                <div style="font-size:12px; color:#8E8E93">üìÖ ${h.data} | üî• ${h.calTotal}kcal</div>
                <div style="font-size:13px; margin-top:5px">${h.itens.map(i => i.ex).join(', ')}</div>
            </div>`).join('');
    }

    function switchTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.toggle('active', c.id === id));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'btn-'+id));
    }

    // Inicializa√ß√£o
    render();
    renderHist();
    atualizarSugestoes();
</script>
</body>
</html>
